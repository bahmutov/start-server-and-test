name: ci
on: [push, pull_request]
jobs:
  tests:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout ğŸ›
        uses: actions/checkout@v3

      - name: NPM install
        uses: bahmutov/npm-install@v1

      - name: Run tests ğŸ§ª
        run: npm test

      - name: Run demo 1 ğŸ“Š
        run: npm run demo

      - name: Run demo 2 ğŸ“Š
        run: npm run demo2

      - name: Run demo 3 ğŸ“Š
        run: npm run demo3

      - name: Run demo 4 ğŸ“Š
        run: npm run demo4

      - name: Run demo 5 ğŸ“Š
        run: npm run demo5

      - name: Run demo 6 ğŸ“Š
        run: npm run demo6

      - name: Run demo 7 ğŸ“Š
        run: npm run demo7

      # hmm why are some demos skipped?

      - name: Run demo 11 ğŸ“Š
        run: npm run demo11

      - name: Run demo 12 ğŸ“Š
        run: npm run demo12

      - name: Run demo 9 ğŸ“Š
        run: START_SERVER_AND_TEST_INSECURE=1 npm run demo9

      - name: Run demo cross env ğŸ“Š
        run: npm run demo-cross-env

      - name: Run demo commands ğŸ“Š
        run: npm run demo-commands

      - name: Run demo multiple ğŸ“Š
        run: npm run demo-multiple

      - name: Run demo expect 403 code ğŸ“Š
        run: npm run demo-expect-403

  release:
    needs: ['tests']
    runs-on: ubuntu-latest
    steps:
      - name: Checkout ğŸ›
        uses: actions/checkout@v3

      - name: Semantic Release ğŸš€
        if: github.ref == 'refs/heads/master'
        uses: cycjimmy/semantic-release-action@v3
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          NPM_TOKEN: ${{ secrets.NPM_TOKEN }}
